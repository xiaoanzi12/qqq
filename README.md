# STC15单片机8位LED流水灯程序

## 项目简介

本项目是一个基于STC15系列单片机的8位LED流水灯程序，实现8个LED依次点亮的流水灯效果。

## 硬件要求

### 单片机
- **型号**：STC15F2K60S2（或其他STC15系列单片机）
- **晶振**：11.0592MHz（推荐）或12MHz
- **最小系统**：包含单片机、晶振、复位电路、电源

### LED模块
- **数量**：8个LED
- **连接方式**：共阳极接法（推荐）
- **限流电阻**：330Ω - 1KΩ（根据LED规格选择）

## 电路连接

### 方案一：共阳极接法（程序默认）

```
VCC (+5V)
  |
  +--- LED0阳极 ---[330Ω]--- P1.0
  +--- LED1阳极 ---[330Ω]--- P1.1
  +--- LED2阳极 ---[330Ω]--- P1.2
  +--- LED3阳极 ---[330Ω]--- P1.3
  +--- LED4阳极 ---[330Ω]--- P1.4
  +--- LED5阳极 ---[330Ω]--- P1.5
  +--- LED6阳极 ---[330Ω]--- P1.6
  +--- LED7阳极 ---[330Ω]--- P1.7
```

**说明**：
- LED阳极连接到VCC (+5V)
- LED阴极通过限流电阻连接到单片机P1口
- P1口输出低电平(0)时LED点亮
- P1口输出高电平(1)时LED熄灭

### 方案二：共阴极接法

如果使用共阴极接法，需要修改程序中的`LED_TABLE`数组：

```c
unsigned char code LED_TABLE[8] = {
    0x01,  // 00000001 - LED0点亮
    0x02,  // 00000010 - LED1点亮
    0x04,  // 00000100 - LED2点亮
    0x08,  // 00001000 - LED3点亮
    0x10,  // 00010000 - LED4点亮
    0x20,  // 00100000 - LED5点亮
    0x40,  // 01000000 - LED6点亮
    0x80   // 10000000 - LED7点亮
};
```

## 引脚定义

| 单片机引脚 | LED编号 | 说明 |
|-----------|---------|------|
| P1.0 | LED0 | 第1个LED |
| P1.1 | LED1 | 第2个LED |
| P1.2 | LED2 | 第3个LED |
| P1.3 | LED3 | 第4个LED |
| P1.4 | LED4 | 第5个LED |
| P1.5 | LED5 | 第6个LED |
| P1.6 | LED6 | 第7个LED |
| P1.7 | LED7 | 第8个LED |

## 软件要求

### 开发环境
- **IDE**：Keil µVision 5（或Keil C51）
- **编译器**：C51 Compiler
- **烧录工具**：STC-ISP（STC官方烧录软件）

### 开发环境配置

1. **安装Keil C51**
   - 下载并安装Keil µVision 5
   - 安装C51编译器（51单片机工具链）

2. **创建Keil项目**
   - 打开Keil µVision
   - 创建新项目：`Project → New µVision Project`
   - 选择芯片：STC15F2K60S2（或选择通用的89C52作为替代）
   - 添加源文件：将`main.c`添加到项目中

3. **项目配置**
   - 右键项目名 → `Options for Target`
   - `Target`标签：设置晶振频率（11.0592MHz）
   - `Output`标签：勾选`Create HEX File`
   - `C51`标签：可调整优化级别

## 编译和下载

### 编译程序

1. 打开Keil项目
2. 点击工具栏的编译按钮（或按F7）
3. 查看编译输出，确保没有错误
4. 生成的HEX文件位于项目的`Objects`或`Output`目录

### 下载到单片机

1. **使用STC-ISP**
   - 下载并打开STC-ISP软件
   - 选择芯片型号：STC15F2K60S2
   - 选择串口和波特率
   - 打开HEX文件
   - 设置选项（推荐设置）：
     - 不勾选"下次下载复位"
     - 最高波特率可选择115200
   - 点击"下载/编程"按钮
   - 给单片机重新上电或按复位键开始下载

2. **验证**
   - 下载成功后，单片机会自动运行
   - 观察LED是否按顺序依次点亮
   - 确认流水灯效果是否正常

## 程序说明

### 主要功能

- **单向流水灯**：LED从LED0到LED7依次点亮，循环往复
- **延迟时间**：250ms（可在代码中修改`DELAY_MS`宏定义）
- **P1口配置**：配置为推挽输出模式，提高驱动能力

### 代码结构

```
main.c
├── 头文件包含
├── 硬件连接说明（注释）
├── 宏定义（延迟时间）
├── Delay_ms()      // 延迟函数
├── System_Init()   // 系统初始化函数
└── main()          // 主函数
    ├── LED码表定义
    ├── 系统初始化
    └── 主循环（流水灯逻辑）
```

### 实现方法

程序提供了两种实现方法：

1. **查表法**（默认启用）
   - 预先定义LED状态表`LED_TABLE[]`
   - 循环查表输出到P1口
   - 代码清晰易懂，便于修改

2. **移位法**（代码中已注释）
   - 通过位移操作动态生成LED状态
   - 代码更简洁，但不如查表法直观
   - 适合理解位操作

## 参数调整

### 修改流水速度

在`main.c`中修改延迟时间宏定义：

```c
#define DELAY_MS 250  // 修改此值调整速度（单位：毫秒）
```

- **加快速度**：减小数值（如100ms）
- **减慢速度**：增大数值（如500ms）

### 修改晶振频率

如果使用不同的晶振（如12MHz），需要调整延迟函数参数：

```c
void Delay_ms(unsigned int ms)
{
    unsigned int i, j;
    for(i = 0; i < ms; i++)
    {
        // 12MHz晶振使用以下值
        for(j = 0; j < 130; j++)  // 调整此处
        {
            _nop_();
            _nop_();
            _nop_();
            _nop_();
        }
    }
}
```

## 扩展功能

### 建议的扩展方向

1. **双向流水灯**
   - LED从0到7流动，然后从7到0反向流动

2. **多种模式切换**
   - 单个LED流动
   - 多个LED同时流动
   - 跑马灯效果
   - 呼吸灯效果

3. **速度可调**
   - 添加按键控制流水速度
   - 使用可变电阻（ADC）调速

4. **使用定时器**
   - 用定时器中断替代软件延迟
   - 提高时间精度，CPU可处理其他任务

## 常见问题

### Q1: 编译时提示找不到STC15.h头文件

**解决方案**：
- 将`#include <STC15.h>`改为`#include <reg52.h>`
- 或从STC官网下载STC15系列头文件并添加到项目中

### Q2: LED不亮或全亮

**检查项**：
- 确认LED极性是否正确
- 检查限流电阻是否合适
- 确认P1口配置是否正确
- 检查电源供电是否正常
- 测量P1口电平是否有变化

### Q3: 流水速度不准确

**原因**：
- 软件延迟受晶振频率影响
- 编译器优化级别会影响延迟

**解决方案**：
- 调整延迟函数中的循环参数
- 使用定时器实现精确延迟

### Q4: 下载失败

**解决方案**：
- 检查串口连接是否正常
- 确认单片机型号选择是否正确
- 在STC-ISP中勾选"断电再上电"
- 降低波特率重试

## 技术支持

- **STC官网**：http://www.stcmicro.com/
- **STC-ISP下载**：http://www.stcmicro.com/rjxz.html
- **Keil官网**：http://www.keil.com/

## 许可证

本项目代码可自由使用、修改和分发，用于学习和商业用途。

## 更新日志

- **v1.0** (2024)
  - 初始版本
  - 实现基本的8位LED流水灯功能
  - 包含详细的中文注释和文档

---

**祝您使用愉快！如有问题，欢迎反馈。**
